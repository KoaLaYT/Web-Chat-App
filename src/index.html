<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>NextJs ws test</title>
    </head>
    <body>
        <input /><button>send</button>
    </body>
    <script>
        ;(function IIFE() {
            'use strict'

            const input = document.querySelector('input')
            const btn = document.querySelector('button')
            const socket = new WebSocket('ws://www.koalayt.top/chat')

            socket.onopen = function() {
                console.log('Connected!')
                btn.addEventListener('click', sendMsg)
            }

            socket.onclose = function() {
                console.log('Closed!')
                btn.removeEventListener('click', sendMsg)
            }

            socket.onmessage = function(data) {
                console.log(data)
            }

            function sendMsg() {
                socket.send(
                    JSON.stringify({
                        event: 'message',
                        data: 'hello',
                    }),
                )
            }
        })()
    </script>
</html>
